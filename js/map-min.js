const d3=window.d3,Promise=window.Promise,topojson=window.topojson;var labelSize=30,updateMapFunc,files=["data/ch.json","data/votes.json?1"],promises=[];files.forEach(function(t){promises.push(d3.json(t))});var color_relative=d3.scaleLinear().domain([15,50,85]).range(["#ff0000","#ffffff","green"]);Promise.all(promises).then(function(t){function e(t,e,o){var a=topojson.feature(c,c.objects.geojson).features;t.append("g").attr("class","cantons_layer").selectAll(".country").data(a).enter().append("path").attr("class","country").attr("d",i).style("fill",function(t,e){return color_relative(d[o][e])});var n=r.selectAll("text").data(d[o]).enter().append("svg:text").attr("class","cantons-label").text(function(t){return console.log("xx"),"test"}).attr("transform",function(t){return s([t.centroid_lon,t.centroid_lat])?"translate("+s([t.centroid_lon,t.centroid_lat])+")":(console.log("No projection for "+t.name),"")}).attr("text-anchor","middle").attr("fill","black")}var o=$("#card-77 > div.card-section.card-body"),a=.6*o.width(),n=.65*a;console.log(a);var r=d3.select("#map").append("svg").attr("width",a).attr("height",n),s=d3.geoMercator().scale(10*a).center([8,46.7]).translate([a/2,n/2]),i=d3.geoPath().projection(s),l={x:a/2,y:n/2},c=t[0],d=t[1],p=0;e(r.append("g"),t,0),updateMapFunc=function(t){console.log("Update to votation "+t+" "+d[t][27]);var e=d3.transition().duration(200).ease(d3.easeLinear),o=d3.transition().duration(300).ease(d3.easeLinear);d3.selectAll(".country").transition(e).style("opacity",.5).transition(o).style("fill",function(e,o){return color_relative(d[t][o])}).transition(e).style("opacity",1)}});